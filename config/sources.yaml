version: 1

# YAML as a version-controlled "source of truth" for Stage 1.3 crawl config.
# Import into Postgres via:
#   npm run config:import
#
# Notes:
# - `sources[].config` is stored as JSONB in `sources.config`.
# - `marathonSources[]` links a marathon (by canonicalName) to a specific `sourceUrl`.
# - This file is safe to commit: DO NOT put tokens or secrets here.

sources:
  - name: 赛事官方网站（直采）
    type: official
    strategy: HTML
    baseUrl: null
    priority: 100
    isActive: true
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "Generic official-site connector. Prefer JSON-LD Event; allow per-site CSS rules."
    config:
      extract:
        # Optional: per-site overrides can be added here in DB (Admin UI) or in YAML.
        # Example:
        # raceDate:
        #   selector: 'meta[property="event:start_date"]'
        #   attr: "content"
        # registrationStatus:
        #   selector: ".registration-status"
        #   attr: "text"
        # registrationUrl:
        #   selector: "a[href*='register']"
        #   attr: "href"

  # 官网示例（来源：docs/研究报告-马拉松数据源调研.md）
  - name: 北京马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.beijing-marathon.com
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 上海马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.shang-ma.com
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 厦门马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.xmim.org
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 广州马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.gzmarathon.com
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 杭州马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.hzim.org
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 成都马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.chengdumarathon.com
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 武汉马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.wuhanmarathon.com
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  - name: 深圳马拉松官网
    type: official
    strategy: HTML
    baseUrl: https://www.szmarthon.com
    priority: 95
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 86400
    notes: "官网示例来源于数据源调研报告"
    config: {}

  # 报名平台（来源：docs/研究报告-马拉松数据源调研.md）
  - name: 最酷体育（Zuicool）
    type: platform
    strategy: HTML
    baseUrl: https://www.zuicool.com
    priority: 90
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 21600
    notes: "国内主流马拉松报名平台之一。完整爬虫实现包括：Cheerio HTML解析、增量更新逻辑、错误重试机制。参考测试文档：docs/审查报告/测试文档-最酷体育爬虫实现-2026-02-17.md"
    config:
      discovery:
        list:
          itemLink:
            selector: "a.event-a[href*='/event/']"
            attr: "href"
      extract:
        # 赛事日期提取规则
        # 优先级：1) JSON-LD Event schema, 2) CSS selector, 3) regex fallback
        raceDate:
          selector: ".event-date, .race-date, [class*='date'], meta[property='event:start_time']"
          attr: "text"
          regex: "(20\\d{2})-(\\d{1,2})-(\\d{1,2})"
          group: 0
        # 报名状态提取
        registrationStatus:
          selector: ".registration-status, .event-status, [class*='status']"
          attr: "text"
        # 报名链接提取
        registrationUrl:
          selector: "a[href*='register'], a[href*='signup'], a[href*='baoming'], .register-btn"
          attr: "href"

  - name: 芝华安方体育
    type: platform
    strategy: HTML
    baseUrl: https://www.zhihuianfang.com
    priority: 86
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 21600
    notes: "专业赛事运营公司"
    config: {}

  - name: 爱燃烧（iranshao）
    type: platform
    strategy: HTML
    baseUrl: https://iranshao.com
    priority: 88
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 21600
    notes: "跑步社区+赛事报名"
    config:
      discovery:
        list:
          # iranshao.com is a content site; category pages list race/event posts.
          # Example list URL:
          # - https://iranshao.com/category/race/%e9%a9%ac%e6%8b%89%e6%9d%be
          itemLink:
            selector: "a[rel='bookmark'][href$='.html']"
            attr: "href"

  - name: 42旅（42travel）
    type: platform
    strategy: HTML
    baseUrl: https://www.42travel.com
    priority: 75
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 21600
    notes: "跑步社区和赛事聚合"
    config: {}

  - name: 悦跑圈（JoyRun）
    type: platform
    strategy: HTML
    baseUrl: https://www.thejoyrun.com
    priority: 70
    isActive: false
    retryMax: 3
    retryBackoffSeconds: 30
    requestTimeoutMs: 15000
    minIntervalSeconds: 21600
    notes: "跑步APP+赛事信息"
    config: {}

  # 搜索/发现（只用于 discovery，不做定时抓取）
  - name: Brave 搜索
    type: search
    strategy: API
    baseUrl: https://api.search.brave.com/res/v1/web/search
    priority: 40
    isActive: false
    retryMax: 1
    retryBackoffSeconds: 1
    requestTimeoutMs: 15000
    minIntervalSeconds: 0
    notes: "用于发现新增/小型赛事；结合 AI/人工筛选后再绑定到 Marathon Sources"
    config: {}

# Optional: bind specific marathon official pages for crawling.
# The marathon must already exist in DB (seeded) with matching canonicalName.
marathonSources: []
  # - marathonCanonicalName: Tokyo Marathon
  #   sourceName: 赛事官方网站（直采）
  #   sourceUrl: https://www.marathon.tokyo/en/
  #   isPrimary: true
