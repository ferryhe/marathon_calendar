# 开发日志 - 2026年2月10日

## 阶段一第二步：列表筛选增强与详情页落地

### 一、目标与范围

本次开发按 `docs/项目计划-完整开发路线图.md` 的阶段一继续推进，聚焦以下三项：

1. 首页列表筛选能力补齐（月份/年份/报名状态/排序）。
2. 列表展示改为使用真实赛事日期与真实报名状态。
3. 新增赛事详情页路由与完整详情展示（基础信息、历年信息、评论统计）。

---

### 二、分步实施记录（逐步完成）

#### 步骤 2.1：后端赛事列表与热度接口增强

**对应提交：** `6d2ad4f`

**实现内容：**

1. 扩展 `GET /api/marathons` 查询参数：
   - `year`
   - `month`
   - `status`
   - `sortBy` 新增 `raceDate`
2. 列表返回项增加 `nextEdition`，用于前端直接渲染真实赛事日期和报名状态。
3. 新增 `GET /api/marathons/hot`，按评论数/评分排序返回热门赛事。

**关键文件：**
- `server/routes.ts`

---

#### 步骤 2.2：前端首页筛选与真实字段展示

**对应提交：** `3a069ec`

**实现内容：**

1. 首页新增筛选控件：
   - 月份筛选
   - 报名状态筛选
   - 排序方式（按时间/按名称）
2. 列表渲染逻辑改造：
   - 优先使用 `nextEdition.raceDate` 作为展示日期
   - 优先使用 `nextEdition.registrationStatus` 作为报名状态
3. 列表项状态徽标改为按状态动态展示。

**关键文件：**
- `client/src/pages/Home.tsx`
- `client/src/components/MarathonTable.tsx`
- `client/src/lib/apiClient.ts`
- `client/src/hooks/useMarathons.ts`
- `client/src/components/EventDetails.tsx`

---

#### 步骤 2.3：赛事详情页路由与页面实现

**对应提交：** `da50f7c`

**实现内容：**

1. 新增路由：
   - `/marathons/:id`
2. 新增详情页能力：
   - 赛事基础信息
   - 官网链接
   - 历年举办信息（editions）
   - 评论数量与平均分
   - 评论列表（前10条）
3. 在弹窗详情中补充“查看完整详情页”入口，串联首页与详情页。

**关键文件：**
- `client/src/App.tsx`
- `client/src/pages/MarathonDetail.tsx`
- `client/src/components/EventDetails.tsx`

---

### 三、测试与验证

#### 3.1 构建验证

执行命令：

```bash
npm run build
```

结果：
- 前端与后端构建均成功。

#### 3.2 接口验证

在独立端口启动后验证（`PORT=5100/5101`）：

1. `GET /api/marathons?sortBy=raceDate&sortOrder=asc&limit=3` -> `200`
2. `GET /api/marathons?status=报名中&limit=3` -> `200`
3. `GET /api/marathons?year=2026&month=3&country=China&limit=3` -> `200`
4. `GET /api/marathons/hot?limit=3` -> `200`
5. `GET /api/marathons/:id` -> `200`

#### 3.3 页面路由验证

1. `GET /marathons/:id` 返回页面 `200`。
2. 首页弹窗“查看完整详情页”可进入详情页。

---

### 四、验收清单

#### 4.1 阶段一第二步验收结果

1. [x] 列表支持年份/月份/状态筛选
2. [x] 列表支持按赛事时间排序
3. [x] 列表展示真实赛事日期与报名状态
4. [x] 新增赛事详情页路由与页面
5. [x] 详情页展示基础信息、历年信息、评论统计
6. [x] 构建通过与关键接口验证通过

#### 4.2 未完成项（保留到后续步骤）

1. [ ] 列表按热度排序（前端入口）
2. [ ] 列表分页/无限滚动
3. [ ] 详情页相关赛事推荐
4. [ ] 详情页分享功能

---

### 五、开发设计说明（简要）

1. 列表查询采用“马拉松基础条件 + 版本条件”组合方式，确保 `year/month/status` 与赛事版本数据绑定。
2. 前端直接消费 `nextEdition`，减少重复请求，避免页面端再二次拼装日期/状态。
3. 详情页复用已有详情接口，先完成读取与展示闭环，后续再叠加推荐与交互能力。

---

### 六、提交记录（本次多提交）

1. `6d2ad4f` - `feat(api): add marathon list filters and hot endpoint for phase1 step2`
2. `3a069ec` - `feat(web): implement phase1 step2 list filters with real edition date and status`
3. `da50f7c` - `feat(web): add marathon detail route and detail page for phase1 step2`

---

### 七、下一步建议（阶段一后续）

1. 实现前端“按热度排序”入口并接入 `/api/marathons/hot`。
2. 补齐列表分页（或无限滚动）与请求参数联动。
3. 在详情页加入“相关赛事推荐”与“分享”功能，完成 1.1.2 剩余项。
