# 开发日志 - 2026-02-11 - 阶段一第十四步实现（报名平台爬虫：列表发现 + 详情绑定）

## 目标
1. 为“报名平台”（最酷体育/爱燃烧等）补齐“列表发现 -> 详情绑定”的半自动流程入口。
2. 让平台接入路径与官网一致：绑定到 `marathon_sources` 后，复用现有 scheduler + extract + merge 管线做定时抓取。

## 主要改动
### 1) 新增 Admin API：列表发现
- 新增：`POST /api/admin/discovery/list`
  - 输入：`sourceId` + `listUrl`
  - 读取：`sources.config.discovery.list.itemLink`（selector/attr/regex/group）
  - 输出：从 listUrl 页面抽取到的详情页链接（URL + title）

### 2) 管理后台 UI：平台列表发现入口
- 更新：`/admin/data` -> “绑定/发现” Tab
  - 新增 Card：“平台列表发现（HTML）”
  - 选择 Source + 输入列表页 URL -> 返回链接列表 -> “作为绑定 URL”
  - 后续仍通过 “Bind Marathon Source” 把 URL 绑定到具体赛事（marathonId）

### 3) YAML 配置示例
- 更新：`config/sources.yaml`
  - 为 “最酷体育（Zuicool）” 提供默认 selector 示例：
    - `a.event-a[href*='/event/']`
  - 为 “爱燃烧（iranshao）” 提供分类页文章链接 selector 示例：
    - `a[rel='bookmark'][href$='.html']`

## 验收与验证
### 自动化检查（已通过）
- `npm run check`
- `npm run build`

### 需要你手工测试的点
1. 确保 sources 配置已导入（只做一次即可）：
   - `npm run config:import`
2. 打开 `/admin/data` -> “绑定/发现” Tab -> “平台列表发现（HTML）”
3. 最酷体育（推荐先测）：
   - Source 选 “最酷体育（Zuicool）”
   - List URL 填 `https://www.zuicool.com/events`
   - 点击“发现链接”，应返回若干 `https://zuicool.com/event/xxxx` 详情页
4. 点击某条结果的“作为绑定 URL”，然后在 “Bind Marathon Source” 里选择 marathonId + sourceId + 绑定
5. 绑定后：
   - 启用该 Source（Sources Tab 里 `isActive=true`）
   - 触发一次同步验证（同步 Tab 的 “立即同步一次” 或单条验证）

## 下一步建议
1. 针对平台详情页建立 `sources.config.extract`（可用 AI 规则模板生成器辅助），使平台能稳定抽取日期/报名状态/报名链接。
2. 为平台源补齐“列表页翻页/增量发现”的能力（当前为单页发现）。

