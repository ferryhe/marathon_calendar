# 开发日志 - 2026-02-10 - 阶段一第十一步实现（管理后台信息架构优化 + Overview 统计）

## 目标
1. 梳理并降低 `/admin/data` 的信息密度，把能力按“工作流”分区，减少误操作与理解成本。
2. 增加一个“Overview 概览”视图，一屏看到 sources/raw/runs 的健康度与近 24h 指标。
3. 明确区分“单次触发同步”与“定期更新（Scheduler）”的配置入口与含义。

## 主要改动
### 1) 新增 Admin 概览统计接口
- 新增：`GET /api/admin/stats`（管理员 token 保护）
  - sources：total/active
  - marathon_sources：total
  - raw_crawl_data：按 status 计数 + 近 24h 按 status 计数
  - marathon_sync_runs：近 24h 按 status 计数

### 2) 前端 Admin API 增补
- 更新：`client/src/lib/adminApi.ts`
  - 新增 `AdminStats` 类型
  - 新增 `getAdminStats(token)` 调用 `/api/admin/stats`

### 3) `/admin/data` 改为 Tab 化（信息架构）
- 更新：`client/src/pages/AdminData.tsx`
  - Tabs：`概览 / Sources / 同步 / 绑定/发现 / needs_review / 定期更新`
  - Tab 选择写入 localStorage：`mc_admin_tab`
  - Query 按 Tab 开关 `enabled`，避免无关页面频繁请求
  - 概览页展示 `GET /api/admin/stats` 指标，并提供“立即同步一次”的快捷入口

## 验收与验证
### 自动化检查（已通过）
- `npm run check`
- `npm run build`

### 手工验收要点
1. 打开 `/admin/data`，输入并保存 `ADMIN_API_TOKEN` 后，切换各 Tab 均能正常加载。
2. 概览 Tab：
   - 能看到 sources、marathon_sources、raw 状态分布、近 24h run 分布
   - “立即同步一次”可触发同步
3. “定期更新” Tab：
   - 能看到 `SYNC_SCHEDULER_ENABLED`、`SYNC_SCHEDULER_INTERVAL_MS` 的配置说明（当前版本仍以 env 为准，未做 UI 配置化）。

## 下一步建议
1. 推进“发布态（Draft/Published）”分层，前台只展示 published，未确认/待复核进入独立区域或仅管理员可见。
2. 增加“AI 规则模板生成器”：从某条 raw 一键生成 `sources.config.extract` 模板，管理员审核后保存并立刻验证。

